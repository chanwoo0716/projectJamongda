<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="/layout/layout">
<head>
<meta charset="UTF-8">
<title>마이페이지</title>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script type="text/javascript" th:src="@{/js/common.js}"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style>
	html,
	body {
	  position: relative;
	  min-width: 1250px;
	  max-width: 1920px;
	  margin: 0 auto;
	}

	body {
	  background: rgb(252, 252, 252);
	  font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
	  font-size: 14px;
	  color: #000;
	  margin: 0 auto;
	  padding: 0 auto;
	  /*background-color: #f4f4f4;*/
	}

	.mypage-container {
	    width: 600px;
	    margin: 50px auto;
	    padding: 20px;
	    background-color: #fff;
	    border-radius: 10px;
	    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	}

	.header {
	    text-align: left;
	    margin-bottom: 20px;
	}

	.header h1 {
	    margin: 0;
	    font-size: 24px;
	    color: #333;
	}

	.header p {
	    margin: 5px 0 20px;
	    color: #777;
	}

	.review-link, .reBooking-link {
		padding: 10px 50px;
		border: 1px solid #ddd;
		border-radius: 5px;
		background-color: #fafafa;
	}
	
	.review-link:hover, .reBooking-link:hover {
	    background-color: rgb(212, 212, 212); /* Darker green on hover */
	}

	.booking-history h2 {
	    margin-bottom: 20px;
	}

	.booking-card {
	    border: 1px solid #ddd;
	    border-radius: 5px;
	    background-color: #fafafa;
	    padding: 20px;
	    margin-bottom: 20px;
	}

	.booking-header {
	    display: flex;
	    justify-content: space-between;
	    align-items: center;
	    border-bottom: 1px solid #ddd;
	    padding-bottom: 10px;
	    margin-bottom: 10px;
	}

	.booking-header .booking-date,
	.booking-header .booking-number {
	    font-size: 14px;
	    color: #777;
	}

	.details-link {
	    color: #1a73e8;
	    text-decoration: none;
	    font-size: 14px;
	}

	.booking-content {
	    display: flex;
	    align-items: center;
	}

	.acc-image {
	    border-radius: 5px;
	    margin-right: 20px;
	}

	.hotel-info {
	    font-size: 14px;
	}

	.hotel-info .acc-name {
	    font-weight: bold;
	    font-size: 16px;
	    margin-bottom: 5px;
	}

	.hotel-info .ro_name,
	.hotel-info .booking-dates,
	.hotel-info .check-in-out {
	    margin-bottom: 5px;
	}
	
.myReviews-btn {
	width: 100%;
	padding: 10px;
	border: 1px solid #ddd;
	border-radius: 5px;
	background-color: #fafafa;
	margin-bottom: 20px;
	cursor: pointer;
	text-align: left;
}
</style>
<script>	
	function openPopup(boNumber) {
	    var url = '/mypage/myBookingDetails.do?number=' + encodeURIComponent(boNumber);
		
		// 팝업창 위치 조정하기
		var popupW = 600;
		var popupH = 700;
		var top = Math.ceil((window.screen.height - popupH)/2);
		var left = Math.ceil((window.screen.width - popupW)/2);
		var option='width=' + popupW + ',height=' + popupH + ',scrollbars=yes, top=' + top + ',left=' + left + ', resizable=yes';
		
	    window.open(url, 'popup', option);
	}
</script>
</head>
<body>
    <th:block layout:fragment="content">
		<div class="mypage-container">
		    <div class="header">
		        <h1>마이페이지</h1>
		        <p th:text="${guest.name} + '님'"></p>
		        <p>안녕하세요</p>
				<form action="/member/updateMemberForm.do" method="post" id="updateMemberForm">
				    <input type="hidden" name="email" th:value="${guest.email}">
				    <input type="hidden" name="ro_id" th:value="${latestBooking.ro_id}">
				    <button type="submit">내 정보 관리 ></button>
				</form>
		    </div>
			
	        <div class="reviews">
				<form action="/mypage/myReviews.do" method="post" id="myReviews">
				    <input type="hidden" name="email" th:value="${guest.email}">
				    <button type="submit" class="myReviews-btn">내가 작성한 리뷰 보러가기</button>
				</form>
	        </div>
			
		    <div class="booking-history">
		    	<div>
			        <h2>예약내역 <a href="/mypage/allBookings.do" class="details-link">더보기</a></h2>
		    	</div>
				<div class="booking-card" th:if="${latestBooking != null}">
				    <div class="booking-header">
				        <span class="booking-date" th:text="'결제일자 : ' + ${latestBooking['payDate']}"></span>
				        <span class="booking-number" th:text="'예약번호 : ' + ${latestBooking['bo_number']}"></span>
						<a href="#" class="details-link" th:attr="onclick='openPopup(' + ${latestBooking['bo_number']} + ')'">상세보기</a>						
				    </div>
				    <div class="booking-content">
				        <div class="hotel-info">
				            <div class="acc-name" th:text="${latestBooking['acc_name']}"></div>
				            <div class="ro_name" th:text="${latestBooking['ro_name']}"></div>
				            <input type="hidden" th:text="${latestBooking['ro_id']}"></input>
				            <div class="booking-dates" th:text="${latestBooking['bo_checkIn']} + ' ~ ' + ${latestBooking['bo_checkOut']}"></div>
				            <div class="check-in-out" th:text="'체크인 ' + ${latestBooking['ro_checkIn']} + ' | 체크아웃 ' + ${latestBooking['ro_checkOut']}"></div>
				        </div>
				    </div>
					<div >
						<a th:href="@{/review/reviewForm.do(number=${latestBooking.bo_number},aname=${latestBooking.acc_name},rid=${latestBooking.ro_id},rname=${latestBooking.ro_name})}" class="review-link" th:if="${isPastCheckout}">리뷰 등록</a>
						<a th:href="@{/search/detailSearch.do(aid=${latestBooking.acc_id})}" class="reBooking-link">다시 예약</a>
					</div>
				</div>
		    </div>
			
			<!-- 고객센터 섹션 -->
			<div class="chatbot-section">
				<h2>고객센터</h2>
				<div>
					<a href="#" >챗봇 연결</a>
				</div>
			</div>
		</div>
    </th:block>
</body>
</html>
