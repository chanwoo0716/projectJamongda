<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/layout">
<head>
<meta charset="UTF-8">
<title>리뷰 페이지</title>
<link rel="stylesheet" th:href="@{/css/reviewPage.css}" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style>
    html,
    body {
        position: relative;
        min-width: 1250px;
        max-width: 1920px;
        margin: 0 auto;
    }

    body {
        background: rgb(252, 252, 252);
        font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
        font-size: 14px;
        color: #000;
        margin: 0;
        padding: 0;
    }

    .myReviews-container {
        width: 40%;
        margin: 50px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .header {
        text-align: left;
        margin-bottom: 20px;
    }

    .header h1 {
        margin: 0;
        font-size: 24px;
        color: #333;
    }

    .header p {
        margin: 5px 0 20px;
        color: #777;
    }

    .reviews {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #fafafa;
        margin-bottom: 20px;
    }

    .myReviews-container h2 {
        font-size: 20px;
        margin-bottom: 10px;
        color: #333;
    }

    .myReviews-container p {
        margin: 5px 0;
        font-size: 14px;
        color: #555;
		word-wrap: break-word; /* 긴 단어가 있을 경우 줄바꿈 */
		overflow-wrap: break-word; /* 긴 단어가 있을 경우 줄바꿈 */
    }

	.ro_name {
		color: #ccc;
		word-wrap: break-word; /* 긴 단어가 있을 경우 줄바꿈 */
		overflow-wrap: break-word; /* 긴 단어가 있을 경우 줄바꿈 */
		
	}
	
    .myReviews-container span {
        font-weight: bold;
    }

	.myReviews-container div {
	    background-color: #fff;
	    padding: 15px;
	    border-radius: 5px;
	    margin-bottom: 20px;
	    border-bottom: 1px solid #ddd; /* 구분선 추가 */
	}
	
	.myReviews-container div:last-child {
	    border-bottom: none;
	}

    .myReviews-container img {
        max-width: 150px;
        max-height: 150px;
        border-radius: 5px;
        margin-right: 15px;
    }

    .myReviews-container div a {
        display: inline-block;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #fafafa;
        color: #1a73e8;
        text-decoration: none;
        font-size: 14px;
    }

    .myReviews-container div a:hover {
        background-color: #e1e1e1;
    }
	
	.load-more-btn {
	    display: block;
	    width: 100%;
	    padding: 10px;
	    border: none;
	    border-radius: 5px;
	    color: rgb(137, 137, 137);
	    font-size: 14px;
	    text-align: center;
	    cursor: pointer;
	    margin-top: 20px;
	}
	.load-more-btn:hover {
		cursor: pointer;
		color: rgb(114, 114, 114);
	}
	
	.image-gallery {
	    display: flex;
	    flex-wrap: wrap;
	    gap: 10px; /* 이미지 사이의 간격 조정 */
	}

	.review-image {
	    width: 100px; /* 원하는 너비 */
	    height: 100px; /* 원하는 높이 */
	    object-fit: cover; /* 이미지 비율 유지, 상자에 맞게 잘림 */
	    border-radius: 5px; /* 선택 사항: 모서리 둥글게 */
	}
</style>
<script th:inline="javascript">
    /*<![CDATA[*/
    const email = /*[[${guest.email}]]*/ 'default@example.com'; // 타임리프 변수를 JavaScript 변수에 할당
    /*]]>*/
    console.log('이메일 :' + email);
</script>
<script>
    $(document).ready(function() {
        let page = 1; // 현재 페이지
        const pageSize = 5; // 페이지 당 리뷰 수

        function loadReviews() {
            console.log('Loading reviews for page:', page); // 페이지 확인
            $.ajax({
                url: '/mypage/getReviewsAjax', // 실제 URL로 변경
                method: 'POST',
                data: { email: email, page: page, size: pageSize },
                success: function(data) {
                    console.log('Data received:', data); // 데이터 확인
                    if (data && data.length > 0) {
                        data.forEach(review => {
                            let reviewHtml = `
								<div>
								    <p><span>${review.rev_date}</span></p>
								    <div class="image-gallery">
								        ${review.images.map(image => 
								            `<img src="/review/downloadImage?rev_image=${image.rev_image}" alt="Review Image" class="review-image"/>`
								        ).join('')}
								    </div>
								    <p><span class="ro_name">${review.ro_name}</span></p>
								    <p><span>${review.rev_content}</span></p>
								</div>
                            `;
                            $('#reviews').append(reviewHtml);
                        });
                        page++;
                    } else {
                        $('#loadMore').hide(); // 더 이상 로드할 리뷰가 없으면 버튼 숨기기
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.error('AJAX Error:', textStatus, errorThrown);
                    alert('리뷰를 로드하는 데 실패했습니다.');
                }
            });
        }

        // 페이지 로드 시 첫 번째 페이지의 리뷰 로드
        loadReviews();

        // 더 보기 버튼 클릭 시 추가 리뷰 로드
        $('#loadMore').on('click', function() {
            loadReviews();
        });
    });
</script>
</head>
<body>
    <th:block layout:fragment="content">
        <div class="myReviews-container">
            <div id="reviews">
                <!-- 리뷰는 AJAX를 통해 로드됩니다. 초기 상태는 비어 있어야 합니다. -->
            </div>
            <button id="loadMore" class="load-more-btn">▼더보기</button>
        </div>
    </th:block>
</body>
</html>
