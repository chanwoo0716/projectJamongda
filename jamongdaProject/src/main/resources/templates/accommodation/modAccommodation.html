<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="/layout/layout">
	  
<head>
<meta charset="UTF-8">
<title>숙소/객실 관리 페이지</title>
<style>
	legend {
		/*display : none;*/
		font-weight: bold;
		position: absolute;
		left: -9999px;
	}

	/* 사이드바 스타일
    #sidebar {
        width: 200px;
        background-color: #f0f0f0;
        padding: 20px;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        height: 100%;
        top: 0;
        left: 0;
    }
	*/
    /* 콘텐츠 영역 스타일 */
    #content {
        margin-left: 220px; /* 사이드바 너비 + 여백 */
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 20px;
        width: calc(100% - 220px); /* 사이드바를 제외한 나머지 너비 */
    }
	
    #accRegArea {
        /*width: 500px;*/
        background-color: #ffffff;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
		margin: 0 auto;
    }

    fieldset {
        border: 1px solid #ccc;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
    }

    label {
        /*display: block;*/
        margin-bottom: 8px;
        font-weight: bold;
    }

    input[type="text"],
    input[type="number"],
    textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }

    .regAcc {
        /*display: flex;
        justify-content: space-between;
		*/
    }

    .regAcc input {
        padding: 10px 20px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 4px;
        cursor: pointer;
    }

    .regAcc input:hover {
        background-color: #0056b3;
    }
	/*
	#content {
		margin : 20px auto;
	}
	*/
	.accRoForm {
		margin : 20px auto;
		max-width : 700px;
		padding : 20px;
		box-sizing : border-box;
		text-align : center;
	}
	
</style>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script>
	//숙소 전화번호 '-' 자동 추가
	function oninputTel(target) {
	    let value = target.value.replace(/[^0-9]/g, ''); // 숫자 이외의 문자 제거

	    if (value.length === 10) {
	        // 0123456789 -> 01-2345-6789 형식으로 변환
	        target.value = value.replace(/(\d{2})(\d{4})(\d{4})/, "$1-$2-$3");
	    } else if (value.length === 8) {
	        // 12341234 -> 1234-1234 형식으로 변환
	        target.value = value.replace(/(\d{4})(\d{4})/, "$1-$2");
	    } else if (value.length === 9) {
	        // 0212341234 -> 02-1234-1234 형식으로 변환
	        target.value = value.replace(/(\d{2})(\d{3})(\d{4})/, "$1-$2-$3");
	    } else {
	        // 그 외의 경우는 입력값 그대로 출력
	        target.value = value;
	    }
	}
	
	//숙소 등록 이미지 추가
	let accCount=1;
	function fn_accommodation_addFile() {
		if(accCount < 6) {
			$('#accommodation_file').append(
				'<div id="accommodationFileDiv' + accCount + '">' +
				'<input type="file" name="acc_image' + accCount + '">' +
				'<button type="button" onclick="fn_accommodation_removeFile(' + accCount + ')">X</button>' +
				'<br>' +
				'</div>'
			);
			accCount++;
		}else {
			alert("숙소 이미지는 최대 5장까지 등록하실 수 있습니다");
		}
	}
	//숙소 등록 이미지 취소
	function fn_accommodation_removeFile(id) {
	    $('#accommodationFileDiv' + id).remove();
	    accCount--;
	}
	
	//객실 등록 이미지 추가
	let roomCount=1;
	function fn_room_addFile() {
		if(roomCount < 6) {
			$('#room_file').append(
				'<div id="roomFileDiv' + roomCount + '">' +
				'<input type="file" name="ro_image' + roomCount + '">' +
				'<button type="button" onclick="fn_room_removeFile(' + roomCount + ')">X</button>' +
				'<br>' +
				'</div>'
			);
			roomCount++;
		}else {
			alert("객실당 이미지는 최대 5장까지 등록하실 수 있습니다");
		}
	}
	//객실 등록 이미지 취소
	function fn_room_removeFile(id) {
	    $('#roomFileDiv' + id).remove();
	    roomCount--;
	}
	
	/*
	// 객실 추가 버튼 클릭 시 실행되는 함수
	let roomFieldsetCount = 0;
	function addRoomFieldset() {
	    if (roomFieldsetCount < 4) {
	        roomFieldsetCount++;

	        // 새로운 필드셋 추가
	        let newFieldset = document.createElement('fieldset');
	        newFieldset.innerHTML = document.getElementById('roomFieldset').innerHTML;
	        newFieldset.id = 'roomFieldset' + roomFieldsetCount;

	        // 필드셋 내 input[type="file"] ID 변경
	        let inputs = newFieldset.querySelectorAll('input[type="file"]');
	        inputs.forEach(function(input) {
	            let nameAttr = input.getAttribute('name');
	            input.setAttribute('name', nameAttr.replace(/[0-9]/, roomFieldsetCount));
	        });

	        // 삭제 버튼을 누를 때 필드셋 제거
	        let removeButton = document.createElement('button');
	        removeButton.type = 'button';
	        removeButton.textContent = '삭제';
	        removeButton.onclick = function() {
	            document.getElementById('roomFieldset' + roomFieldsetCount).remove();
	            roomFieldsetCount--;
	        };
	        newFieldset.appendChild(removeButton);

	        document.getElementById('accRegArea').appendChild(newFieldset);
	    } else {
	        alert("객실은 최대 5개까지 등록하실 수 있습니다.");
	    }
	}

	// 객실 필드셋 삭제 버튼 클릭 시 실행되는 함수
	function removeRoomFieldset() {
	    if (roomFieldsetCount > 0) {
	        document.getElementById('roomFieldset' + roomFieldsetCount).remove();
	        roomFieldsetCount--;
	    } else {
	        alert("숙소당 최소 한개의 객실을 등록해주세요.");
	    }
	}
	*/
	//등록 요청 acc_tel
	function submitForm() {
	    // 필수 입력 필드들을 확인
	    let acc_name = document.getElementById('acc_name').value.trim();
	    let acc_area = document.getElementById('acc_area').value.trim();
		let acc_tel = document.getElementById('acc_tel').value.trim();
	    let acc_address = document.getElementById('acc_address').value.trim();
	    let acc_info = document.getElementById('acc_info').value.trim();
	    let ro_name = document.getElementById('ro_name').value.trim();
	    let ro_min = document.getElementById('ro_min').value.trim();
	    let ro_max = document.getElementById('ro_max').value.trim();
	    let ro_amenities = document.getElementById('ro_amenities').value.trim();
	    let ro_info = document.getElementById('ro_info').value.trim();
	    let ro_price = document.getElementById('ro_price').value.trim();
		let ro_checkIn = document.getElementById('ro_checkIn').value.trim();
		let ro_checkOut = document.getElementById('ro_checkOut').value.trim();
		
	    // 필수 입력 필드가 비어있는지 확인
	    if (acc_name === '' || acc_area === '' || acc_tel === '' || acc_address === '' || acc_info === '' ||
	        ro_name === '' || ro_min === '' || ro_max === '' || ro_amenities === '' ||
	        ro_info === '' || ro_price === '' || ro_checkIn === '' || ro_checkOut === '') {
	        alert("정보를 모두 기입해주세요.");
	        return;
	    }
		// 숙소 이미지 필수 입력 확인
        let acc_image_count = $('#accommodation_file input[type="file"]').length;
        if (acc_image_count === 0) {
            alert("숙소 이미지를 등록해주세요.");
            return;
        }

        // 객실 이미지 필수 입력 확인
        let ro_image_count = $('#room_file input[type="file"]').length;
        if (ro_image_count === 0) {
            alert("객실 이미지를 등록해주세요.");
            return;
        }

	    // 확인 메시지 후 폼 제출
	    if (confirm("관리자의 승인 후 숙소 등록이 가능합니다.                                  숙소등록을 요청하시겠습니까?")) {
	        document.getElementById('regAccommodation').submit();
	    }
	}

	//다시 입력
	function resetForm() {
	    if (confirm("다시 입력하시겠습니까?")) {
	        document.getElementById('regAccommodation').reset();
	        $('#accommodation_file').empty();
	        $('#room_file').empty();
	        accCount = 1;
	        roomCount = 1;
	    }
	}
</script>
</head>
<body>
	<!--사이드바 영역-->
	<!--<div id="sidebar" th:include="hostSidebar :: sidebar"></div>-->
	<!--숙소/객실 등록 영역-->
	<div id="content">
		<th:block layout:fragment="content">
			<h2>숙소/객실 등록</h2>
			<div class="accRoForm">
				<section id="accRegArea">
					<!--"등록"누르면 숙소/객실 관리 화면으로 이동(addAcc로가고 listAcc.html로 보내야함 -->
		            <form action="/accommodation/addAccommodation.do" method="post" id="regAccommodation" name="regAccommodation" enctype="multipart/form-data">
						<!--숙소 등록-->
		                <fieldset>
							<h2>숙소 등록</h2>
		                    <legend>숙소 등록 폼</legend>
		                    <p>
		                        <label for="acc_name">숙소 이름</label>
		                        <input type="text" id="acc_name" name="acc_name" required placeholder="숙소 이름을 입력해주세요.">
		                    </p>
		                    <p>
		                        <label>숙소 유형</label>
								<label for="hotelResort">호텔/리조트</label>
							    <input type="radio" id="hotelResort" name="acc_type" value="호텔/리조트" checked>
							    <label for="motel">모텔</label>
							    <input type="radio" id="motel" name="acc_type" value="모텔">
							    <label for="pension">펜션</label>
							    <input type="radio" id="pension" name="acc_type" value="펜션">
							    <label for="glamping">글램핑</label>
							    <input type="radio" id="glamping" name="acc_type" value="글램핑">
		                    </p>
							
		                    <p>
								<!--서울/강릉/제주도/속초/여수/부산/인천/가평-->
		                        <label for="acc_area">숙소 지역</label>
		                        <input type="text" id="acc_area" name="acc_area" required placeholder="지역명을 입력해주세요.">
		                    </p>
							
							<p>
							    <label for="acc_tel">숙소 전화번호</label>
							    <input type="tel" oninput="oninputTel(this)" id="acc_tel" name="acc_tel" required placeholder="전화번호를 입력해주세요.">
							</p>
							
		                    <p>
		                        <label for="acc_address" class="labelAddress">숙소 주소</label>
		                        <input type="text" id="acc_address" name="acc_address" maxlength="100" size="60" required placeholder="입력 예)서울시 강남구 서초동 11">
		                    </p>
							
							<p>
								<label for="acc_info">숙소 소개</label>
								<textarea rows="10" cols="50" id="acc_info" name="acc_info" maxlength="4000" required placeholder="숙소 상세 설명..."></textarea>
							</p>
							
							<p>
								<label for="acc_image">숙소 이미지 등록</label>
								<input type="button" id="acc_image" value="파일추가" onclick="fn_accommodation_addFile()">
								<div id="accommodation_file"></div>
							</p>
		                </fieldset>
						
						<!--객실 등록-->
		                <fieldset id="roomFieldset">
							<h2>대표 객실 등록</h2>
		                    <legend>대표 객실 등록 폼</legend>
		                    <p>
		                        <label for="ro_name">대표 객실 이름</label>
		                        <input type="text" id="ro_name" name="ro_name" required placeholder="객실 이름을 입력해주세요.">
		                    </p>
							
							<p>
		                        <label for="ro_min">기준 수용 인원</label>
		                        <input type="number" id="ro_min" name="ro_min" required>
		                    </p>
							
							<p>
			                    <label for="ro_max">최대 수용 인원</label>
			                    <input type="number" id="ro_max" name="ro_max" required>
			                </p>
							
							<p>
							    <label for="ro_amenities">편의시설</label>
							    <input type="text" id="ro_amenities" name="ro_amenities" required placeholder="TV, 에어컨, 냉장고, 헤어드라이기...">
							</p>
							
							<p>
								<label for="ro_info">대표 객실 소개</label>
								<textarea rows="10" cols="50" id="ro_info" name="ro_info" maxlength="4000" required placeholder="객실 상세 설명..."></textarea>
							</p>
							
							<p>
								<label for="ro_image">대표 객실 이미지 등록</label>
								<input type="button" id="ro_image" value="파일추가" onclick="fn_room_addFile()">
								<div id="room_file"></div>
							</p>
							
							<p>
								<label for="ro_price">대표 객실 가격</label>
								<input type="number" id="ro_price" name="ro_price" required>
							</p>
							
							<p>
							    <label for="ro_checkIn">입실 시간</label>
							    <input type="text" id="ro_checkIn" name="ro_checkIn" required placeholder="15:00">
								<label for="ro_checkOut">퇴실 시간</label>
							    <input type="text" id="ro_checkOut" name="ro_checkOut" required placeholder="12:00">
							</p>
							<p>
							    <button type="button" onclick="addRoomFieldset()">객실 추가</button>
							    <button type="button" onclick="removeRoomFieldset()">삭제</button>
							</p>
							
		                </fieldset>
						<div class="regAcc">
					       <input type="button" value="등록요청" onclick="submitForm()">
					       <input type="button" value="다시 입력" onclick="resetForm()">
						   <!--<input type="hidden" name="boolAcc" value="false">-->
					   </div>
		            </form>
		        </section>
			</div>
		</th:block>
	</div>
</body>
</html>